define("poidetail:widget/libs/poiDetailCard/poiDetailCard.js",function(e,i,a){function t(e){e=e||{},e.padding=0,e.monopolize=!0,e.overflow="hidden",n.call(this,e),this.uid=e.uid,this.name=e.name,this.geo=e.geo,this.cardLevel=2,this.canNotFold=!0,this.returnTitle="返回“"+this.name+"”的详情",this.recordUrl="poi:"+this.uid,e.withMarker&&(this.pBindMarkerAndBubble(e.marker),this.withMarker=e.marker)}var n=e("common:widget/ui/card/Card.js"),o=e("common:widget/ui/card/cardMgr.js"),s=e("common:widget/ui/searchBox/searchBox.js"),r=e("common:widget/ui/util/util.js"),d=e("common:widget/ui/mapUtil/mapUtil.js"),h=e("common:widget/ui/constant/Constant.js"),l={common:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_RED_OFFSET,imageOffset:new BMap.Size(0,193),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET},highlight:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,233),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET},clicked:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,233),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET}};T.inherits(t,n,"PoiDetailCard"),T.extend(t.prototype,{render:function(){try{}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/libs/poiDetailCard/poiDetailCard.js",ln:76})}},onResize:function(e){function i(){var e=$(".poidetail-container").find(".generalHead-left-header"),i=$(".poidetail-container").find(".generalHead-right-header"),a=$(".poidetail-container").find(".generalHead-padding");n?(e.removeClass("animation-heightrelease").addClass("animation-heightadd2"),e.find("span.generalHead-titlename").css({"white-space":"normal"}),e.find(".business-vertify")&&(e.find(".business-vertify").addClass("business-vertify-newtop"),T.browser.safari&&T("#vertifyinfo").css("top","-23px"))):e.removeClass("animation-heightrelease").addClass("animation-heightadd"),i.removeClass("animation-heightrelease").addClass("animation-heightadd"),a.removeClass("animation-paddingrelease").addClass("animation-paddingadd"),$(".poidetail-container").find(".generalHead-right-route").removeClass("animation-route-button-hide").addClass("animation-route-button-show"),$(".generalHead-left-header-aoitag").removeClass("animation-route-aoitag-hide").addClass("animation-aoitag-show"),$(".generalHead-left-header-visit").removeClass("animation-visittag-hide").addClass("animation-visittag-show")}function a(){var e=$(".poidetail-container").find(".generalHead-left-header"),i=$(".poidetail-container").find(".generalHead-right-header"),a=$(".poidetail-container").find(".generalHead-padding");n?e.removeClass("animation-heightadd2").addClass("animation-heightrelease"):e.removeClass("animation-heightadd").addClass("animation-heightrelease"),e.find("span.generalHead-titlename").css({"white-space":"nowrap"}),e.find(".business-vertify")&&(e.find(".business-vertify").removeClass("business-vertify-newtop"),T.browser.safari&&T("#vertifyinfo").css("top","-3px")),i.removeClass("animation-heightadd").addClass("animation-heightrelease"),a.removeClass("animation-paddingadd").addClass("animation-paddingrelease"),$(".poidetail-container").find(".generalHead-right-route").removeClass("animation-route-button-show").addClass("animation-route-button-hide"),$(".generalHead-left-header-aoitag").removeClass("animation-aoitag-show").addClass("animation-aoitag-hide"),$(".generalHead-left-header-visit").removeClass("animation-visittag-show").addClass("animation-visittag-hide")}var t=this.$cardEl,n=this.titleNeedWrap;$(".generalHead-titlename ")&&$(".generalHead-titlename ").last()&&$(".generalHead-titlename ").last().height()>30&&(n=this.titleNeedWrap=!0);var o=$(".poidetail-container").find(".customerHead"),s=$(".poidetail-container").find(".customerOther");if(s.length){var r=s.height();s.css("height","auto"),s.css("overflow-y","auto"),s.css("max-height",e-o.height()-80);var d,h=(t.height(),0),l=!0;s.off("scroll").on("scroll",function(){var e=$(this)[0].scrollTop;d=e>h?"down":"up",h=e,h>0&&"down"===d&&(l&&(a(),l=!1),r>=t.height()-45&&s.height(t.height()-45)),0===h&&"up"===d&&(l=!0,i(),setTimeout(function(){s.height(t.height()-o.height())},600))})}},initialize:function(){try{window.iFrameResize({log:!1},".hotelBookFrame"),T.browser.safari&&T("#vertifyinfo")&&T("#vertifyinfo").css("top","-24px")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/libs/poiDetailCard/poiDetailCard.js",ln:201})}},setInfoWindow:function(e){this.infoWindow=e},onFold:function(){o.removeCardFromGroup(this.cardId,"sole"),o.removeCardFromGroup(this.cardId,"result"),o.removeCardFromGroup(this.cardId,"poidetail"),this.withMarker&&!this.lockMarkerHighlight&&this.withMarker.unhighlight&&this.withMarker.unhighlight()},onUnfold:function(){o.addCardToGroup(this.cardId,"poidetail"),o.addCardToGroup(this.cardId,"sole"),o.addCardToGroup(this.cardId,"result"),s.setState("sole",{query:this.name,cardId:this.cardId}),this.childMarkers&&this.childMarkers.forEach(function(e){e.unhighlightMarker&&e.unhighlightMarker()}),this.withMarker&&this.withMarker.highlight&&this.withMarker.highlight()},pBindMarkerAndBubble:function(e){var i=r.getPointByStr(r.parseGeo(this.geo).points),a=this;if(i){var t=!1;e||(this.marker=new BMap.Marker(i,{icon:this.pCreateIcon(l.common),zIndexFixed:!0,startAnimation:"marker-raise marker-0"}),map.addOverlay(this.marker),d.setViewport([i],10),t=!0),this.name&&"string"==typeof this.name&&r.loadSearchSimpleInfo(function(e){var n=e.createCommonInfoWindow({name:a.name},{x:i.lng,y:i.lat,uid:a.uid,isFromMPC:!1});n&&(a.infoWindow=n,t&&a.pBindEvents())})}},pCreateIcon:function(e){return new BMap.Icon(e.image,e.size,{anchor:e.offset,imageOffset:e.imageOffset,infoWindowOffset:e.infoWindowOffset,imageSize:e.imageSize,srcSet:e.srcSet})},pBindEvents:function(){var e=this;this.marker.addEventListener("click",function(){this.setIcon(e.pCreateIcon(l.clicked)),this.openSimpleInfoWindow(e.infoWindow),this.clicked=!0}),this.marker.addEventListener("mouseover",function(){this.clicked!==!0&&this.setIcon(e.pCreateIcon(l.highlight))}),this.marker.addEventListener("mouseout",function(){this.clicked!==!0&&this.setIcon(e.pCreateIcon(l.common))}),this.infoWindow.addEventListener("close",function(){e.marker.clicked=!1,e.marker.setIcon(e.pCreateIcon(l.common))})},unload:function(){window.temp&&window.temp.detailInfoPop&&window.temp.detailInfoPop.close(),this.infoWindow&&(this.infoWindow.close(),this.infoWindow=null),this.marker&&(map.removeOverlay(this.marker),this.marker=null),this.childMarkers&&(this.childMarkers.forEach(function(e){map.removeOverlay(e)}),this.childMarkers=null),this.jssdkBaseData&&(this.jssdkBaseData=null),this.dispatchEvent("unload")}}),a.exports=t});
;define("poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",function(require,exports,module){var style=".poidetail-container{position:relative;font-size:12px}.poidetail-container .mt10{margin-top:10px}.poidetail-container .top-border-override{border-top:1px solid #fff;position:relative}.poidetail-container .text-overflow{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.poidetail-container .title{height:40px;line-height:45px;position:relative}.poidetail-container .title .icon{width:21px;height:21px;display:inline-block;border-radius:50%;color:#FFF;background-color:#6cc8ef;position:absolute;left:0;top:11px;line-height:22px;text-align:center}.poidetail-container .title .caption{margin-left:25px;color:#333}.poidetail-container .title .more{position:absolute;display:block;right:0;top:15px;line-height:normal;color:#999;text-decoration:none}.poidetail-container .accept-default-image{border:0;background:url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_b0276c9.png);background:-webkit-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_b0276c9.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_249ed48.png) 2x);background:-moz-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_b0276c9.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_249ed48.png) 2x);background:-o-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_b0276c9.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_249ed48.png) 2x);background:-ms-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_b0276c9.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_249ed48.png) 2x);background-size:cover}.poidetail-container .customerOther>div:last-child>div.bottom-split{border-bottom:0}";require.loadCss({content:style,name:"poiDetailMgr"});var bannerStyle=".poiLeadDownloadCard .download-banner .download-img{float:left;margin:10px 19px 10px 16px}.poiLeadDownloadCard .download-banner .title{padding-top:16px;margin-bottom:4px;line-height:28px;height:28px;font-size:20px;color:#000}.poiLeadDownloadCard .download-banner .sub-title{line-height:16px;height:16px;font-size:16px;color:#666}.poiLeadDownloadCard .download-banner{pointer-events:auto;position:relative}.poiLeadDownloadCard .close-btn-download-banner{position:absolute;width:20px;height:20px;line-height:20px;font-size:28px;text-align:center;display:block;cursor:pointer;right:6px;top:8px;color:#ccc}.poiLeadDownloadCard .qrcode-box{float:left;margin:10px 19px 10px 16px;width:60px;height:60px}";require.loadCss({content:bannerStyle,name:"poiDownloadBanner"});var DynamicWidgetsPageMgr=require("common:widget/com/dynamicWidgetsPageMgr.js"),cardMgr=require("common:widget/ui/card/cardMgr.js"),PoiDetailCard=require("poidetail:widget/libs/poiDetailCard/poiDetailCard.js"),searchBox=require("common:widget/ui/searchBox/searchBox.js"),toast=require("common:widget/ui/toast/toast.js"),unifyMgr=require("poidetail:widget/unify/unifyMgr/unifyMgr.js"),jigsawVerify=require("common:widget/ui/JigsawVerification/JigsawVerification.js"),DynamicBanner=require("common:widget/com/DynamicBanner/DynamicBanner.js"),deviceRatio=window.devicePixelRatio>1?2:1,linkDOM=document.createElement("a"),poiDetailMgr={create:function(e,a){listener.trigger("poiDeatailMagr.create"),window.testbegin=new Date,this.opts=e||{},a=a||{};var t=1,i=this,o=T.extend(e,{ugc_type:"3",ugc_ver:"1",qt:"detailConInfo",device_ratio:deviceRatio,compat:t,t:(new Date).getTime()});return searchBox.loading(),new Promise(function(e,t){function n(o,n){var d={resolve:e,reject:t};if(o&&o.result){var l=o.result;if(window.AUTH=l.auth,99===l.type)return void jigsawVerify.open("",l.image,l.jigsawImage,function(){r.data.auth=window.AUTH,T.ajax("/",r)},function(){i.error("验证失败",t)})}o&&1===o.isUnify?unifyMgr.init(o,a,d):i.processData(o,a,d),require.async(["common:widget/ui/urlManager/urlManager.js"],function(e){linkDOM.href=n.responseURL;var t="";o&&o.content&&(t=o.content.name);var i=linkDOM.search;a.noPushState||e.setFeature("poi",t,i,a.replaceState),e.setTitle(t)})}var r;r={method:"GET",data:o,timeout:3e3,dataType:"json",success:n,error:function(){i.error(null,t)}},T.ajax("/",r)})},error:function(e,a){e=e||"当前信息加载失败，请稍后再试",toast.show(e,"warning"),searchBox.endLoading(),a(e)},processData:function(e,a,t){if(!e||!e.content)return void this.error("",t.reject);this.opts&&this.opts.isBizPoi&&(e.isBizPoi=!0);var i=e.content.indoor_pano||"";if(e.content.indoor_pano_id="",""!==i){var o=/&sid=([0-9a-z]+?)&/i.exec(i);o&&(e.content.indoor_pano_id=o[1])}e._extra_={enableComment:!0},e.content.ext=e.content.ext||{},e.content.ext.detail_info=e.content.ext.detail_info||{},e.content.ext.detail_info.groupon=e.content.ext.detail_info.groupon||[],e.content.ext.rich_info=e.content.ext.rich_info||{},e.content.ext.other_info=e.content.ext.other_info||{},e.content.ext.src_name=e.content.ext.src_name||"",e.interSource=e.interSource||"",e.hasDetailPage="ninf"===e.interSource?!0:!1;for(var n=e.content.ext.detail_info.std_tag||e.content.ext.detail_info.tag||e.content.ext.src_name||"",r=["医疗","公交","车站","地铁站","dt_stop","房地产","政府机构","洗浴按摩"],d=r.length-1;d>=0;d--){var l=new RegExp(r[d],"i");if(l.test(n)){e._extra_.enableComment=!1;break}}e.content.poiType&&1===e.content.poiType&&(e._extra_.enableComment=!1),this.distribute(e,a,t)},distribute:function(e,a,t){var i={};e.content&&e.content.ext&&(i=e.content.ext);var o,n=i.src_name||this.opts.industry||"";switch(n){case"scope":o=require("poidetail:widget/industry/scopeIndustryMgr.js");break;case"hotel":o=require("poidetail:widget/industry/hotelIndustryMgr.js");break;case"cater":o=require("poidetail:widget/industry/caterIndustryMgr.js");break;default:o=require(i.movie_forsearch&&"movie"===i.movie_forsearch.business_scope_type?"poidetail:widget/industry/movieIndustryMgr.js":"poidetail:widget/industry/lifeIndustryMgr.js")}this.buildPoiDetailPage(o,e,a,t)},buildPoiDetailPage:function(industryMgr,pageData,options,promiseHandler){var me=this;industryMgr.init(pageData,function(pageOpts){var uid=pageData&&pageData.content&&pageData.content.uid,name=pageData&&pageData.content&&pageData.content.name,geo=pageData&&pageData.content&&pageData.content.geo;options=options||{},options=T.extend({record:!0},options),options=T.extend(options,{uid:uid,name:name,geo:geo});var poiDetailCard=new PoiDetailCard(options);promiseHandler.resolve({poiDetailCard:poiDetailCard,data:pageData}),pageOpts.pageData=pageOpts.pageData||pageData,pageOpts.containerClass="poidetail-container";var widgetsArrange=[];widgetsArrange.push({js:"poidetail:widget/ui/generalHead/generalHead.js",data:pageData.content,wrapClass:"customerHead"}),widgetsArrange.push({children:pageOpts.widgets,wrapClass:"customerOther"}),pageOpts.widgets=widgetsArrange;var dynamicWidgetsPageMgr=new DynamicWidgetsPageMgr(pageOpts);dynamicWidgetsPageMgr.addEventListener("renderComplete",function(){try{poiDetailCard.render=function(){try{if(addStat("poidetail.card.render","show"),pageOpts&&pageOpts.pageData){var e=pageOpts.pageData;e.industry&&addStat("poidetail."+e.industry+".render","show")}return dynamicWidgetsPageMgr.getPageDom()}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",ln:332})}},searchBox.endLoading(),cardMgr.add(poiDetailCard,{isReturn:options.isReturn}).then(function(){var poiLeadDownloadEl=$(".poiLeadDownloadCard");if(poiLeadDownloadEl.length)baidu.dom.insertAfter(poiLeadDownloadEl[0],poiDetailCard.$cardEl[0]),poiLeadDownloadEl[0].style.display="block",$(".poiLeadDownloadCard .download-img").hide();else{var leadDownloadCard='<div class="poiLeadDownloadCard"></div>',template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="download-banner">    <div class="close-btn-download-banner" title="关闭">×</div>       <img src="',"undefined"==typeof qrcodeUrl?"":baidu.template._encodeHTML(qrcodeUrl),'" alt="二维码" width="60" height="60" class="download-img"/>    <div class="qrcode-box"></div>    <div>        <p class="title">扫码下载百度地图</p>        <p class="sub-title">',"undefined"==typeof subTitle?"":baidu.template._encodeHTML(subTitle),"</p>    </div></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],wrapEl=T(leadDownloadCard),urlImg="//webmap1.bdimg.com/wolfman/static/poidetail/images/qrcode-download/poi-map-dowload-test_43a78a0.png",banner=template({qrcodeUrl:urlImg,subTitle:"世界很复杂,百度地图更懂你"});wrapEl.append(banner),poiDetailCard.$cardEl&&poiDetailCard.$cardEl[0]&&(baidu.dom.insertAfter(wrapEl[0],poiDetailCard.$cardEl[0]),$(".poiLeadDownloadCard .download-img").hide())}var jumpLink=me.getJumpLink(uid);DynamicBanner.renderQrCode(jumpLink,".poiLeadDownloadCard .download-img",".poiLeadDownloadCard .qrcode-box"),DynamicBanner.renderDynamicTitle({bannerContainer:".poiLeadDownloadCard",name:"poiDetail"}),$(".poiLeadDownloadCard")&&$(".poiLeadDownloadCard")[0]&&$(".poiLeadDownloadCard").on("click",".close-btn-download-banner",function(){$(".poiLeadDownloadCard").hide()}),listener.on("ui.cardmgr","removegroup",function(e,a){a=a||{},"removegroup"===e&&"poidetail"===a.group&&$(".poiLeadDownloadCard")&&$(".poiLeadDownloadCard").length&&$(".poiLeadDownloadCard").remove()}),searchBox.setState("sole",{query:name,cardId:poiDetailCard.cardId},{keepResult:options.record})}),cardMgr.addCardToGroup(poiDetailCard.cardId,"poidetail")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",ln:389})}}),dynamicWidgetsPageMgr.addEventListener("endLoading",function(){searchBox.endLoading()}),dynamicWidgetsPageMgr.buildPage(poiDetailCard)})},getJumpLink:function(e){var a="baidumap://map/place/detail?show_type=detail_page&uid="+e+"&src=mapdownload.pcmap.all.placedetail",t="WEBAPP2015",i="https://map.baidu.com/mapclient-pages/download/?from=pcmap&openapi="+encodeURIComponent(a)+"&token="+t;return i}};module.exports=poiDetailMgr});
;define("poidetail:widget/libs/poiDetailUtil/poiDetailUtil.js",function(e,r,t){var n={isIE:function(e){var r=document.createElement("b");return r.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===r.getElementsByTagName("i").length},len:function(e){for(var r=0,t=e.length,n=-1,i=0;t>i;i++){var n=e.charCodeAt(i);r+=n>=0&&128>=n?1:2}return r},sub:function(e,r){var t=/[^\x00-\xff]/g;if(e.replace(t,"mm").length<=r)return e;for(var n=Math.floor(r/2),i=n;i<e.length;i++)if(e.substr(0,i).replace(t,"mm").length>=r)return e.substr(0,i)+"...";return e},isEmptyobj:function(e){if(e){for(var r in e)return!1;return!0}return!0}};t.exports=n});