define("common:widget/ui/messageCenter/messageCenter.js",function(require,exports,module){var $messageCenter=T("#message-center"),$panel=T("#message-panel"),$entrance=T(".message-center-entrance"),panelShowed=!1,hasOpertaionCnt=!1,firstEnter="",UserMgr=require("common:widget/ui/userMgr/userMgr.js"),nowTime="",clickCloseTime="",intervalTime="",style="#message-panel .message-close{width:24px;height:23px;top:0;right:0;position:absolute;background:url(/static/images/op-close.png) no-repeat right 0;cursor:pointer}#message-panel .message-close:hover{background-position:0 0}#op-activity{background:#fff;padding:12px;overflow:hidden;width:333px;position:relative}#op-activity .qrcode-container{float:left;line-height:20px;height:95px;width:75px;margin-right:8px;text-align:center}#op-activity .activity-banner{overflow:hidden}@media only screen and (-webkit-min-device-pixel-ratio:2),(-webkit-min-device-pixel-ratio:2),(min-resolution:2dppx),(min-resolution:192dpi){#message-panel .message-close{background-image:url(/static/images/retina/op-close.png);background-size:auto 23px}}@keyframes fadeOut{0%{opacity:1}10%{opacity:.9}20%{opacity:.8}30%{opacity:.7}40%{opacity:.6}50%{opacity:.5}60%{opacity:.4}70%{opacity:.3}80%{opacity:.2}90%{opacity:.1}100%{opacity:0}}@-webkit-keyframes fadeOut{0%{opacity:1}10%{opacity:.9}20%{opacity:.8}30%{opacity:.7}40%{opacity:.6}50%{opacity:.5}60%{opacity:.4}70%{opacity:.3}80%{opacity:.2}90%{opacity:.1}100%{opacity:0}}.anim_fade{position:absolute;animation-name:fadeOut;-webkit-animation-name:fadeOut;animation-timing-function:ease-in-out;-webkit-animation-timing-function:ease-in-out;animation-duration:1s;-webkit-animation-duration:1s;animation-delay:0s;-webkit-animation-delay:0s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}";require.loadCss({content:style,name:"messagepanel"});var style=".scenic3d-panel{line-height:20px;height:346px;width:500px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.scenic3d-panel .header{height:145px;background-image:url(//webmap0.bdimg.com/wolfman/static/common/images/scenic3d/hint-pic-1x_48f04ab.png);background-repeat:no-repeat;background-size:500px auto;background-position:0 0;text-align:center;position:relative}.scenic3d-panel .header .title{padding-top:30px;font-size:24px}.scenic3d-panel .header .title span{letter-spacing:1px}.scenic3d-panel .header .title .beta{position:absolute;font-size:12px;top:27px;left:50%;margin-left:44px;height:16px;line-height:16px;width:42px;border:1px solid #e5e5e5;background-color:#fff;border-radius:2px;color:#666}.scenic3d-panel .header .info{padding-top:20px;font-size:16px}.scenic3d-panel .header .info .down{padding-top:4px}.scenic3d-panel .scenic3d-points{display:-webkit-box;display:-ms-flexbox;display:flex;display:-webkit-flex;-webkit-justify-content:space-around;-ms-flex-pack:distribute;justify-content:space-around;padding:0 30px}.scenic3d-panel .scenic3d-points .point{text-decoration:none;cursor:pointer}.scenic3d-panel .scenic3d-points .icon{background-image:url(//webmap0.bdimg.com/wolfman/static/common/images/scenic3d/hint-pic-1x_48f04ab.png);background-repeat:no-repeat;background-size:500px auto;height:115px;width:116px}.scenic3d-panel .scenic3d-points .huaguiyuan .icon{background-position:-53px -156px}.scenic3d-panel .scenic3d-points .qinghuiyuan .icon{background-position:-188px -149px}.scenic3d-panel .scenic3d-points .shijilian .icon{background-position:-327px -162px}.scenic3d-panel .scenic3d-points .name{text-decoration:none;text-align:center;margin:4px auto 0;color:#fff;font-size:14px;height:24px;line-height:24px;background-color:#2f87ff;width:72px;border-radius:2px}.scenic3d-panel .scenic3d-points .shijilian .name{width:110px}@media only screen and (-webkit-min-device-pixel-ratio:2),(-webkit-min-device-pixel-ratio:2),(min-resolution:2dppx),(min-resolution:192dpi){.scenic3d-panel .scenic3d-points .icon,.scenic3d-panel .header{background-image:url(//webmap1.bdimg.com/wolfman/static/common/images/scenic3d/hint-pic-2x_0055f84.png)}}";require.loadCss({content:style,name:"scenic3dpanel"});var styleOfPanel="#message-panel .message-close{width:24px;height:23px;top:0;right:0;position:absolute;background:url(/static/images/op-close.png) no-repeat right 0;cursor:pointer}#message-panel .message-close:hover{background-position:0 0}#message-panel #activity-banner-panel{box-sizing:border-box;width:420px;height:420px;background-color:#fff;padding-top:39px;background:#fff 30px 145px url(//webmap1.bdimg.com/wolfman/static/common/images/activity-banner/background_47269be.png) no-repeat}#message-panel #activity-banner-panel .activity-title{font-size:20px;height:28px;line-height:28px;text-align:center;color:#000}#message-panel #activity-banner-panel .activity-description{margin-top:9px;font-size:16px;color:#888;line-height:16px;height:16px;text-align:center}#message-panel #activity-banner-panel .main-left{width:150px;float:left;margin-left:53px;margin-top:90px}#message-panel #activity-banner-panel .main-left p{font-size:12px;color:#000;height:18px;line-height:18px;text-align:center}#message-panel #activity-banner-panel .activity-qr-img{margin-bottom:9px;margin-left:7px;height:136px;width:136px}#message-panel #activity-banner-panel .activity-img{margin-top:10px;margin-left:16px;height:299px;width:167px}";require.loadCss({content:styleOfPanel,name:"activityPanel"});var DynamicBanner=require("common:widget/com/DynamicBanner/DynamicBanner.js"),messageCenter={init:function(){var e=this;this.generateContent(function(){e.checkNewMessage(),nowTime=(new Date).getTime(),clickCloseTime=parseInt(window.localStorage.getItem("clickCloseTime"),0),nowTime&&clickCloseTime&&(intervalTime=e.calculateIntervalTime(nowTime,clickCloseTime)),firstEnter=window.localStorage.getItem("firstEnter")||!0,firstEnter=JSON.parse(firstEnter),(firstEnter||intervalTime&&intervalTime>24)&&(window.trafficCtrl&&window.trafficCtrl.opened||e.openPanel()),hasOpertaionCnt||$panel.append('<div class="close-btn-indexpage" title="关闭">&times;</div>')}),this.bindEvents(),T("#sbw_map")&&0===parseInt(T("#sbw_map")[0].style.zIndex,10)&&listener.trigger("com.subway","load")},bindEvents:function(){var e=this;$entrance.on("click",function(){panelShowed?e.closePanel():(addStat("ui.messagecenter.clickshow","show"),window.trafficCtrl&&trafficCtrl.opened&&trafficCtrl.close(),e.openPanel())}),$panel.on("click",".login-btn.need-login",function(){addStat("ui.messagecenter.login","click"),UserMgr.login(void 0,void 0,"message-center")}),$panel.on("click",".close-btn-indexpage",function(){clickCloseTime=e.getClickTime(),window.localStorage.setItem("clickCloseTime",clickCloseTime),window.localStorage.setItem("firstEnter",!1),addStat("ui.messagecenter.clickclose","click"),e.closePanel()}),T("#tool-container").on("click",function(){e.closePanel()}),$panel.on("click",".message-close",function(){e.closePanel()}),$panel.on("click",".point",function(){var e=$(this).data("uid");addStat("gotoscenic3dpage.messagepanel","click"),listener.trigger("toScenic3DPage","click",{uid:e,from:"messagepanel"})}),listener.on("searchbox.search",function(){e.closePanel()}),listener.on("ui.cardmgr","add",function(){e.closePanel()}),listener.on("usercenter.show",function(){e.closePanel()}),listener.on("com.subway","load",function(){$messageCenter.hide(),e.closePanel()}),listener.on("com.subway","unload",function(){e.closePanel(),$messageCenter.show()}),listener.on("ipLocation.correct",function(){e.closePanel()})},getOperationCnt:function(){return new Promise(function(e,t){var i="https://zt.baidu.com/activity/api/config/get?key=a966a54fa149ba6f95aa4f2e7ab971ae";T.jsonp(i,function(i){var n=i||{},a=n.errno,o=n.data;a?t():(DynamicBanner.saveConfigInfo(o),e(o))})})},processOperationData:function(e){var t="//webmap1.bdimg.com/wolfman/static/common/images/qrcode-download/index-map-dowload-test_e676ccd.png",i="//webmap0.bdimg.com/wolfman/static/common/images/activity-banner/activity@2x_24b9112.png",n="世界很复杂，百度地图更懂你",a="精准导航、实时公交、发现周边更多功能等你体验",o="扫码下载百度地图APP",c=e||{},s={};return s.title=c.title||n,s.desc=c.desc||a,s.qrcode=c.qrcode||t,s.picUrl=c.picUrl||i,s.bottomTitle=c.bottomTitle||o,s},generateContent:function(cb){function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}var template="";template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="activity-banner-panel">    <div class="activity-title">',"undefined"==typeof title?"":baidu.template._encodeHTML(title),'</div>    <div class="activity-description">',"undefined"==typeof acDescription?"":baidu.template._encodeHTML(acDescription),'</div>    <div class="main-left">        <img class="activity-qr-img" src="',"undefined"==typeof qrcodeImage?"":baidu.template._encodeHTML(qrcodeImage),'">        <p>',"undefined"==typeof bottomTitle?"":baidu.template._encodeHTML(bottomTitle),'</p>     </div>      <img class="activity-img" src="',"undefined"==typeof activityImage?"":baidu.template._encodeHTML(activityImage),'">    </div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];var defaultImage="//webmap0.bdimg.com/wolfman/static/common/images/new/rightDownload_b292ead.png",defaultImage2x="//webmap0.bdimg.com/wolfman/static/common/images/new/rightDownload2_002367a.png",defaultQrCodeImg="//webmap1.bdimg.com/wolfman/static/common/images/activity-banner/qrcode_943a584.png",defaultActivityImg="//webmap0.bdimg.com/wolfman/static/common/images/activity-banner/activity_ace9c00.png",defaultTitle="世界很复杂，百度地图更懂你",defatultActivityDescription="精准导航、实时公交、发现周边更多功能等你体验",defaultBottomTitle="扫码下载百度地图APP",defaultTpl=template({title:defaultTitle,acDescription:defatultActivityDescription,qrcodeImage:defaultQrCodeImg,activityImage:defaultActivityImg,bottomTitle:defaultBottomTitle}),me=this,operationCnt=this.getOperationCnt();operationCnt.then(function(e){var t=me.processOperationData(e),i=template({title:t.title,acDescription:t.desc,qrcodeImage:t.qrcode,activityImage:t.picUrl,image_2x:defaultImage2x,bottomTitle:t.bottomTitle});$panel.html(i),cb()},function(){$panel.html(defaultTpl),cb()})},checkNewMessage:function(){return hasOpertaionCnt?void this.hasNoNewMessage():void(this.isLogin?this.hasNoNewMessage():this.hasNewMessage())},hasNewMessage:function(){$messageCenter.addClass("has-message")},hasNoNewMessage:function(){$messageCenter.removeClass("has-message")},openPanel:function(){addStat("ui.messagecenter.show","show"),addStat("ui.messagecenter.newqrcodeshow","show"),this.renderItem&&addStat("ui.messagecenter."+this.renderItem.message_type,"show"),$panel.addClass("message-panel-open"),panelShowed=!0},calculateIntervalTime:function(e,t){if(e&&t){var i=parseInt((e-t)/1e3/60/60,0);return i}},getClickTime:function(){return clickCloseTime=(new Date).getTime()},closePanel:function(){addStat("ui.messagecenter.close","click"),$panel.removeClass("message-panel-open"),panelShowed=!1}};module.exports=messageCenter});